<div class="terminal-view-container">
    <!-- Header Section -->
    <div class="terminal-header">
      <div class="header-left">
        <h2>
          <mat-icon>apartment</mat-icon>
          Terminal View
        </h2>
        <p class="header-subtitle">Real-time terminal operations and passenger flow</p>
      </div>
      
      <div class="header-right">
        <div class="view-controls">
          <button mat-button [class.active]="viewMode === 'overview'" (click)="onViewModeChange('overview')">
            <mat-icon>dashboard</mat-icon>
            Overview
          </button>
          <button mat-button [class.active]="viewMode === 'detailed'" (click)="onViewModeChange('detailed')">
            <mat-icon>list</mat-icon>
            Detailed
          </button>
          <button mat-button [class.active]="viewMode === '3d'" (click)="onViewModeChange('3d')">
            <mat-icon>3d_rotation</mat-icon>
            3D View
          </button>
        </div>
      </div>
    </div>
  
    <!-- Control Panel -->
    <div class="control-panel">
      <div class="control-left">
        <!-- Terminal Selector -->
        <mat-form-field appearance="outline" class="terminal-selector">
          <mat-label>Select Terminal</mat-label>
          <mat-select [formControl]="getFilterFormControls(filterForm, 'terminal')" (selectionChange)="onTerminalSelect($event.value)">
            <mat-option value="all">All Terminals</mat-option>
            <mat-option *ngFor="let terminal of terminals" [value]="terminal.id">
              {{ terminal.terminal }}
            </mat-option>
          </mat-select>
          <mat-icon matSuffix>apartment</mat-icon>
        </mat-form-field>
  
        <!-- Quick Stats -->
        <div class="quick-stats">
          <div class="stat-item">
            <mat-icon class="stat-icon">people</mat-icon>
            <div class="stat-content">
              <div class="stat-value">{{ getTotalPassengers() | number }}</div>
              <div class="stat-label">Total Passengers</div>
            </div>
          </div>
          <div class="stat-item">
            <mat-icon class="stat-icon">schedule</mat-icon>
            <div class="stat-content">
              <div class="stat-value">{{ getAverageWaitTime() }} min</div>
              <div class="stat-label">Avg Wait Time</div>
            </div>
          </div>
          <div class="stat-item">
            <mat-icon class="stat-icon">gate</mat-icon>
            <div class="stat-content">
              <div class="stat-value">{{ getOccupiedGates() }}/{{ getFilteredGates().length }}</div>
              <div class="stat-label">Gates Occupied</div>
            </div>
          </div>
        </div>
      </div>
  
      <div class="control-right">
        <!-- Toggle Controls -->
        <div class="toggle-controls">
          <button mat-button [class.active]="showWaitTimes" (click)="toggleWaitTimes()">
            <mat-icon>{{ showWaitTimes ? 'timer' : 'timer_off' }}</mat-icon>
            Wait Times
          </button>
          <button mat-button [class.active]="showPassengerFlow" (click)="togglePassengerFlow()">
            <mat-icon>{{ showPassengerFlow ? 'waves' : 'waves_outlined' }}</mat-icon>
            Passenger Flow
          </button>
          <button mat-button [class.active]="showGateStatus" (click)="toggleGateStatus()">
            <mat-icon>{{ showGateStatus ? 'visibility' : 'visibility_off' }}</mat-icon>
            Gate Status
          </button>
          <button mat-button [class.active]="autoRefresh" (click)="toggleAutoRefresh()">
            <mat-icon>{{ autoRefresh ? 'sync' : 'sync_disabled' }}</mat-icon>
            Auto-refresh
          </button>
        </div>
  
        <!-- Action Buttons -->
        <div class="action-buttons">
          <button mat-raised-button color="primary" (click)="exportTerminalData()">
            <mat-icon>download</mat-icon>
            Export Data
          </button>
          <button mat-raised-button color="accent" (click)="loadTerminalData()">
            <mat-icon>refresh</mat-icon>
            Refresh
          </button>
        </div>
      </div>
    </div>
  
    <!-- Main Content -->
    <div class="terminal-content" [class.detailed-view]="viewMode === 'detailed'">
      
      <!-- Canvas Visualization (Overview & 3D View) -->
      <div *ngIf="viewMode !== 'detailed'" class="visualization-container">
        <div class="canvas-wrapper">
          <canvas #terminalCanvas 
                  class="terminal-canvas"
                  (click)="onCanvasClick($event)"
                  (window:resize)="resizeCanvas()">
            Your browser does not support canvas
          </canvas>
          
          <!-- Overlay Controls -->
          <div class="canvas-overlay">
            <div class="time-display">
              <mat-icon>schedule</mat-icon>
              {{ simulationTime | number:'1.0-0' }}s
            </div>
            <div class="density-control">
              <span>Passenger Density:</span>
              <mat-slider [max]="1" [min]="0.1" [step]="0.1" [(ngModel)]="passengerDensity">
                <input matSliderThumb>
              </mat-slider>
            </div>
          </div>
        </div>
        
        <!-- Terminal Cards -->
        <div class="terminal-cards">
          <div *ngFor="let terminal of terminals" 
               class="terminal-card" 
               [class.selected]="selectedTerminal === terminal.id"
               (click)="onTerminalClick(terminal)">
            <div class="card-header">
              <h3>{{ terminal.terminal }}</h3>
              <span class="crowdedness-badge" [class]="'crowdedness-' + terminal.crowdedness.toLowerCase()">
                {{ terminal.crowdedness }}
              </span>
            </div>
            
            <div class="card-content">
              <div class="terminal-metric">
                <mat-icon>people</mat-icon>
                <div class="metric-info">
                  <div class="metric-value">{{ terminal.passengerCount | number }}</div>
                  <div class="metric-label">Passengers</div>
                </div>
              </div>
              
              <div class="terminal-metric">
                <mat-icon>security</mat-icon>
                <div class="metric-info">
                  <div class="metric-value">{{ terminal.securityWaitTime }} min</div>
                  <div class="metric-label">Security Wait</div>
                </div>
              </div>
              
              <div class="terminal-metric">
                <mat-icon>luggage</mat-icon>
                <div class="metric-info">
                  <div class="metric-value">{{ terminal.baggageWaitTime }} min</div>
                  <div class="metric-label">Baggage Wait</div>
                </div>
              </div>
            </div>
            
            <div class="card-progress">
              <mat-progress-bar mode="determinate" 
                              [value]="getTerminalOccupancy(terminal)"
                              [color]="getProgressColor(terminal.crowdedness)"></mat-progress-bar>
              <span class="progress-label">{{ getTerminalOccupancy(terminal) }}% Occupancy</span>
            </div>
          </div>
        </div>
      </div>
  
      <!-- Detailed Table View -->
      <div *ngIf="viewMode === 'detailed'" class="detailed-view-container">
        <!-- Terminal Details Table -->
        <div class="terminal-details">
          <h3>Terminal Details</h3>
          <table mat-table [dataSource]="terminals" class="mat-elevation-z2">
            
            <!-- Terminal Column -->
            <ng-container matColumnDef="terminal">
              <th mat-header-cell *matHeaderCellDef> Terminal </th>
              <td mat-cell *matCellDef="let terminal">
                <div class="terminal-cell">
                  <mat-icon>apartment</mat-icon>
                  {{ terminal.terminal }}
                </div>
              </td>
            </ng-container>
            
            <!-- Passenger Count Column -->
            <ng-container matColumnDef="passengers">
              <th mat-header-cell *matHeaderCellDef> Passengers </th>
              <td mat-cell *matCellDef="let terminal">
                <div class="passenger-cell">
                  <mat-icon>people</mat-icon>
                  {{ terminal.passengerCount | number }}
                </div>
              </td>
            </ng-container>
            
            <!-- Security Wait Column -->
            <ng-container matColumnDef="securityWait">
              <th mat-header-cell *matHeaderCellDef> Security Wait </th>
              <td mat-cell *matCellDef="let terminal">
                <div class="wait-cell" [class.high]="terminal.securityWaitTime > 20">
                  <mat-icon>timer</mat-icon>
                  {{ terminal.securityWaitTime }} min
                </div>
              </td>
            </ng-container>
            
            <!-- Baggage Wait Column -->
            <ng-container matColumnDef="baggageWait">
              <th mat-header-cell *matHeaderCellDef> Baggage Wait </th>
              <td mat-cell *matCellDef="let terminal">
                <div class="wait-cell" [class.high]="terminal.baggageWaitTime > 15">
                  <mat-icon>luggage</mat-icon>
                  {{ terminal.baggageWaitTime }} min
                </div>
              </td>
            </ng-container>
            
            <!-- Crowdedness Column -->
            <ng-container matColumnDef="crowdedness">
              <th mat-header-cell *matHeaderCellDef> Crowdedness </th>
              <td mat-cell *matCellDef="let terminal">
                <div class="crowdedness-cell" [class]="'level-' + terminal.crowdedness.toLowerCase()">
                  {{ terminal.crowdedness }}
                </div>
              </td>
            </ng-container>
            
            <!-- Actions Column -->
            <ng-container matColumnDef="actions">
              <th mat-header-cell *matHeaderCellDef> Actions </th>
              <td mat-cell *matCellDef="let terminal">
                <button mat-icon-button color="primary" (click)="onTerminalClick(terminal)">
                  <mat-icon>visibility</mat-icon>
                </button>
                <button mat-icon-button color="accent" (click)="openTerminalDashboard(terminal)">
                  <mat-icon>dashboard</mat-icon>
                </button>
              </td>
            </ng-container>
            
            <tr mat-header-row *matHeaderRowDef="['terminal', 'passengers', 'securityWait', 'baggageWait', 'crowdedness', 'actions']"></tr>
            <tr mat-row *matRowDef="let row; columns: ['terminal', 'passengers', 'securityWait', 'baggageWait', 'crowdedness', 'actions'];"></tr>
          </table>
        </div>
  
        <!-- Gate Status Grid -->
        <div class="gate-grid">
          <h3>Gate Status</h3>
          <div class="gate-grid-container">
            <div *ngFor="let gate of getFilteredGates()" 
                 class="gate-card" 
                 [class]="'status-' + gate.status.toLowerCase()"
                 (click)="onGateClick(gate)">
              <div class="gate-header">
                <div class="gate-number">{{ gate.gateNumber }}</div>
                <div class="gate-terminal">{{ gate.terminal }}</div>
              </div>
              
              <div class="gate-status">
                <div class="status-indicator" [style.background]="getGateColor(gate.status)"></div>
                <span>{{ gate.status }}</span>
              </div>
              
              <div class="gate-details">
                <div *ngIf="gate.currentFlight" class="current-flight">
                  <mat-icon>flight_takeoff</mat-icon>
                  {{ gate.currentFlight }}
                </div>
                <div *ngIf="gate.nextFlight" class="next-flight">
                  <mat-icon>schedule</mat-icon>
                  Next: {{ gate.nextFlight }}
                </div>
                <div *ngIf="gate.nextFlightTime" class="next-time">
                  {{ gate.nextFlightTime | date:'HH:mm' }}
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  
    <!-- Footer Stats -->
    <div class="terminal-footer">
      <div class="footer-stats">
        <div class="footer-stat">
          <mat-icon>check_circle</mat-icon>
          <span>Active Terminals: {{ terminals.length }}</span>
        </div>
        <div class="footer-stat">
          <mat-icon>warning</mat-icon>
          <span>High Wait Times: {{ getTerminalsWithHighWait() }}</span>
        </div>
        <div class="footer-stat">
          <mat-icon>gate</mat-icon>
          <span>Available Gates: {{ getAvailableGates() }}</span>
        </div>
        <div class="footer-stat">
          <mat-icon>update</mat-icon>
          <span>Last Updated: {{ lastUpdateTime | date:'HH:mm:ss' }}</span>
        </div>
      </div>
    </div>
  </div>
  
  <!-- Loading Overlay -->
  <div *ngIf="isLoading" class="loading-overlay">
    <mat-spinner diameter="50"></mat-spinner>
    <p>Loading terminal data...</p>
  </div>