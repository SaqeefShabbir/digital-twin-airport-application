<div class="gate-management-container">
    <!-- Header Section -->
    <div class="gate-header">
      <div class="header-left">
        <h2>
          <mat-icon>gate</mat-icon>
          Gate Management
        </h2>
        <p class="header-subtitle">Manage airport gates, assignments, and statuses</p>
      </div>
      
      <div class="header-right">
        <div class="view-controls">
          <button mat-button [class.active]="viewMode === 'table'" (click)="changeViewMode('table')" matTooltip="Table View">
            <mat-icon>table_chart</mat-icon>
          </button>
          <button mat-button [class.active]="viewMode === 'grid'" (click)="changeViewMode('grid')" matTooltip="Grid View">
            <mat-icon>grid_view</mat-icon>
          </button>
          <button mat-button [class.active]="viewMode === 'visual'" (click)="changeViewMode('visual')" matTooltip="Visual View">
            <mat-icon>dashboard</mat-icon>
          </button>
        </div>
        
        <button mat-raised-button color="primary" (click)="openGateAssignment()">
          <mat-icon>add</mat-icon>
          Add New Gate
        </button>
      </div>
    </div>
  
    <!-- Statistics Cards -->
    <div class="statistics-section">
      <div class="statistics-grid">
        <mat-card class="stat-card">
          <div class="stat-content">
            <mat-icon class="stat-icon">gate</mat-icon>
            <div class="stat-details">
              <div class="stat-value">{{ statistics.totalGates }}</div>
              <div class="stat-label">Total Gates</div>
            </div>
          </div>
        </mat-card>
  
        <mat-card class="stat-card">
          <div class="stat-content">
            <mat-icon class="stat-icon" [style.color]="getStatusColor('Available')">check_circle</mat-icon>
            <div class="stat-details">
              <div class="stat-value">{{ statistics.availableGates }}</div>
              <div class="stat-label">Available</div>
            </div>
          </div>
        </mat-card>
  
        <mat-card class="stat-card">
          <div class="stat-content">
            <mat-icon class="stat-icon" [style.color]="getStatusColor('Occupied')">flight_takeoff</mat-icon>
            <div class="stat-details">
              <div class="stat-value">{{ statistics.occupiedGates }}</div>
              <div class="stat-label">Occupied</div>
            </div>
          </div>
        </mat-card>
  
        <mat-card class="stat-card">
          <div class="stat-content">
            <mat-icon class="stat-icon" [style.color]="getStatusColor('Maintenance')">build</mat-icon>
            <div class="stat-details">
              <div class="stat-value">{{ statistics.maintenanceGates }}</div>
              <div class="stat-label">Maintenance</div>
            </div>
          </div>
        </mat-card>
  
        <mat-card class="stat-card">
          <div class="stat-content">
            <mat-icon class="stat-icon" [style.color]="getStatusColor('Closed')">block</mat-icon>
            <div class="stat-details">
              <div class="stat-value">{{ statistics.closedGates }}</div>
              <div class="stat-label">Closed</div>
            </div>
          </div>
        </mat-card>
  
        <mat-card class="stat-card occupancy-card">
          <div class="stat-content">
            <mat-icon class="stat-icon">trending_up</mat-icon>
            <div class="stat-details">
              <div class="stat-value">{{ statistics.occupancyRate }}%</div>
              <div class="stat-label">Occupancy Rate</div>
            </div>
            <mat-progress-bar mode="determinate" [value]="statistics.occupancyRate" 
                            [color]="statistics.occupancyRate > 80 ? 'warn' : statistics.occupancyRate > 60 ? 'accent' : 'primary'">
            </mat-progress-bar>
          </div>
        </mat-card>
      </div>
    </div>
  
    <!-- Control Panel -->
    <div class="control-panel">
      <div class="control-left">
        <!-- Quick Filters -->
        <div class="quick-filters">
          <mat-form-field appearance="outline" class="filter-field">
            <mat-label>Search Gates</mat-label>
            <input matInput [formControl]="filterForm.get('search')" placeholder="Gate, flight, terminal...">
            <mat-icon matSuffix>search</mat-icon>
          </mat-form-field>
  
          <mat-form-field appearance="outline" class="filter-field">
            <mat-label>Status</mat-label>
            <mat-select [formControl]="filterForm.get('status')">
              <mat-option *ngFor="let status of statusFilterOptions" [value]="status.value">
                <div class="status-option" [style.color]="status.color">
                  <mat-icon>{{ getStatusIcon(status.value) }}</mat-icon>
                  {{ status.label }}
                </div>
              </mat-option>
            </mat-select>
          </mat-form-field>
  
          <mat-form-field appearance="outline" class="filter-field">
            <mat-label>Terminal</mat-label>
            <mat-select [formControl]="filterForm.get('terminal')">
              <mat-option *ngFor="let terminal of terminalFilterOptions" [value]="terminal.value">
                {{ terminal.label }}
              </mat-option>
            </mat-select>
          </mat-form-field>
  
          <button mat-button color="warn" (click)="clearFilters()">
            <mat-icon>clear_all</mat-icon>
            Clear Filters
          </button>
        </div>
      </div>
  
      <div class="control-right">
        <!-- Bulk Actions -->
        <div class="bulk-actions" *ngIf="selection.hasValue()">
          <span class="selection-count">{{ selection.selected.length }} gate(s) selected</span>
          <button mat-raised-button color="accent" (click)="openBulkOperation()">
            <mat-icon>playlist_add_check</mat-icon>
            Bulk Actions
          </button>
        </div>
  
        <!-- Action Buttons -->
        <div class="action-buttons">
          <button mat-button [class.active]="autoRefresh" (click)="toggleAutoRefresh()" matTooltip="Auto Refresh">
            <mat-icon>{{ autoRefresh ? 'sync' : 'sync_disabled' }}</mat-icon>
          </button>
          <button mat-button (click)="loadGatesData()" matTooltip="Refresh Data">
            <mat-icon>refresh</mat-icon>
          </button>
          <button mat-button (click)="exportGateData()" matTooltip="Export Data">
            <mat-icon>download</mat-icon>
          </button>
        </div>
      </div>
    </div>
  
    <!-- Main Content Area -->
    <div class="gate-content">
      
      <!-- Table View -->
      <div *ngIf="viewMode === 'table'" class="table-view">
        <!-- Loading State -->
        <div *ngIf="isLoading" class="loading-overlay">
          <mat-spinner diameter="40"></mat-spinner>
          <p>Loading gate data...</p>
        </div>
  
        <!-- Gate Table -->
        <div class="table-container mat-elevation-z2">
          <table mat-table [dataSource]="dataSource" matSort class="gate-table">
            
            <!-- Checkbox Column -->
            <ng-container matColumnDef="select">
              <th mat-header-cell *matHeaderCellDef>
                <mat-checkbox (change)="$event ? toggleAllRows() : null"
                            [checked]="isAllSelected()"
                            [indeterminate]="selection.hasValue() && !isAllSelected()"
                            aria-label="Select all">
                </mat-checkbox>
              </th>
              <td mat-cell *matCellDef="let row">
                <mat-checkbox (click)="$event.stopPropagation()"
                            (change)="$event ? selection.toggle(row) : null"
                            [checked]="selection.isSelected(row)"
                            aria-label="Select row">
                </mat-checkbox>
              </td>
            </ng-container>
  
            <!-- Gate Number Column -->
            <ng-container matColumnDef="gateNumber">
              <th mat-header-cell *matHeaderCellDef mat-sort-header> Gate </th>
              <td mat-cell *matCellDef="let gate">
                <div class="gate-cell">
                  <mat-icon class="gate-icon">gate</mat-icon>
                  <div class="gate-info">
                    <div class="gate-number">{{ gate.gateNumber }}</div>
                    <div class="gate-id">{{ gate.id }}</div>
                  </div>
                </div>
              </td>
            </ng-container>
  
            <!-- Terminal Column -->
            <ng-container matColumnDef="terminal">
              <th mat-header-cell *matHeaderCellDef mat-sort-header> Terminal </th>
              <td mat-cell *matCellDef="let gate">
                <div class="terminal-cell">
                  <mat-icon>apartment</mat-icon>
                  {{ gate.terminal }}
                </div>
              </td>
            </ng-container>
  
            <!-- Status Column -->
            <ng-container matColumnDef="status">
              <th mat-header-cell *matHeaderCellDef mat-sort-header> Status </th>
              <td mat-cell *matCellDef="let gate">
                <div class="status-cell">
                  <span class="status-badge" [style.background]="getStatusColor(gate.status)">
                    <mat-icon>{{ getStatusIcon(gate.status) }}</mat-icon>
                    {{ gate.status }}
                  </span>
                </div>
              </td>
            </ng-container>
  
            <!-- Current Flight Column -->
            <ng-container matColumnDef="currentFlight">
              <th mat-header-cell *matHeaderCellDef> Current Flight </th>
              <td mat-cell *matCellDef="let gate">
                <div class="flight-cell" *ngIf="gate.currentFlight; else noFlight">
                  <mat-icon class="flight-icon">flight_takeoff</mat-icon>
                  <div class="flight-info">
                    <div class="flight-number">{{ gate.currentFlight }}</div>
                    <div class="flight-status">Active</div>
                  </div>
                </div>
                <ng-template #noFlight>
                  <span class="no-flight">-</span>
                </ng-template>
              </td>
            </ng-container>
  
            <!-- Next Flight Column -->
            <ng-container matColumnDef="nextFlight">
              <th mat-header-cell *matHeaderCellDef> Next Flight </th>
              <td mat-cell *matCellDef="let gate">
                <div class="flight-cell" *ngIf="gate.nextFlight; else noNextFlight">
                  <mat-icon class="flight-icon">schedule</mat-icon>
                  <div class="flight-info">
                    <div class="flight-number">{{ gate.nextFlight }}</div>
                    <div class="flight-time" *ngIf="gate.nextFlightTime">
                      {{ gate.nextFlightTime | date:'HH:mm' }}
                    </div>
                  </div>
                </div>
                <ng-template #noNextFlight>
                  <span class="no-flight">-</span>
                </ng-template>
              </td>
            </ng-container>
  
            <!-- Next Flight Time Column -->
            <ng-container matColumnDef="nextFlightTime">
              <th mat-header-cell *matHeaderCellDef mat-sort-header> Next Time </th>
              <td mat-cell *matCellDef="let gate">
                <span *ngIf="gate.nextFlightTime; else noTime">
                  {{ gate.nextFlightTime | date:'HH:mm' }}
                </span>
                <ng-template #noTime>
                  <span class="no-time">-</span>
                </ng-template>
              </td>
            </ng-container>
  
            <!-- Actions Column -->
            <ng-container matColumnDef="actions">
              <th mat-header-cell *matHeaderCellDef> Actions </th>
              <td mat-cell *matCellDef="let gate">
                <div class="action-buttons-cell">
                  <button mat-icon-button color="primary" (click)="openGateAssignment(gate)" matTooltip="Edit Gate">
                    <mat-icon>edit</mat-icon>
                  </button>
                  
                  <button mat-icon-button color="accent" 
                          *ngIf="canAssignFlight(gate)"
                          (click)="openGateAssignment(gate)" 
                          matTooltip="Assign Flight">
                    <mat-icon>flight_takeoff</mat-icon>
                  </button>
                  
                  <button mat-icon-button color="warn" 
                          *ngIf="canReleaseGate(gate)"
                          (click)="releaseGate(gate.id)" 
                          matTooltip="Release Gate">
                    <mat-icon>exit_to_app</mat-icon>
                  </button>
                  
                  <button mat-icon-button 
                          *ngIf="gate.status === 'Maintenance'"
                          (click)="setGateStatus(gate.id, 'Available')" 
                          matTooltip="Mark as Available">
                    <mat-icon>check_circle</mat-icon>
                  </button>
                  
                  <button mat-icon-button 
                          *ngIf="gate.status === 'Available'"
                          (click)="setGateStatus(gate.id, 'Maintenance')" 
                          matTooltip="Mark for Maintenance">
                    <mat-icon>build</mat-icon>
                  </button>
                </div>
              </td>
            </ng-container>
  
            <tr mat-header-row *matHeaderRowDef="displayedColumns"></tr>
            <tr mat-row *matRowDef="let row; columns: displayedColumns;"
                [class.selected]="selection.isSelected(row)"
                (click)="selection.toggle(row)">
            </tr>
          </table>
  
          <!-- No Data Message -->
          <div *ngIf="dataSource.filteredData.length === 0 && !isLoading" class="no-data-message">
            <mat-icon>search_off</mat-icon>
            <p>No gates found matching your filters</p>
            <button mat-button (click)="clearFilters()">Clear Filters</button>
          </div>
  
          <!-- Paginator -->
          <mat-paginator [pageSizeOptions]="[10, 25, 50, 100]" showFirstLastButtons></mat-paginator>
        </div>
      </div>
  
      <!-- Grid View -->
      <div *ngIf="viewMode === 'grid'" class="grid-view">
        <div class="grid-container">
          <div *ngFor="let gate of dataSource.filteredData" 
               class="gate-card" 
               [class.selected]="selection.isSelected(gate)"
               (click)="selection.toggle(gate)">
            
            <div class="card-header" [style.background]="getStatusColor(gate.status)">
              <div class="gate-number">{{ gate.gateNumber }}</div>
              <div class="gate-terminal">{{ gate.terminal }}</div>
              <mat-checkbox class="selection-checkbox"
                           (click)="$event.stopPropagation()"
                           (change)="$event ? selection.toggle(gate) : null"
                           [checked]="selection.isSelected(gate)"
                           aria-label="Select gate">
              </mat-checkbox>
            </div>
  
            <div class="card-content">
              <div class="gate-status">
                <mat-icon>{{ getStatusIcon(gate.status) }}</mat-icon>
                <span>{{ gate.status }}</span>
              </div>
  
              <div class="flight-info" *ngIf="gate.currentFlight">
                <div class="current-flight">
                  <mat-icon>flight_takeoff</mat-icon>
                  <div class="flight-details">
                    <div class="flight-number">{{ gate.currentFlight }}</div>
                    <div class="flight-label">Current Flight</div>
                  </div>
                </div>
              </div>
  
              <div class="flight-info" *ngIf="gate.nextFlight">
                <div class="next-flight">
                  <mat-icon>schedule</mat-icon>
                  <div class="flight-details">
                    <div class="flight-number">{{ gate.nextFlight }}</div>
                    <div class="flight-label" *ngIf="gate.nextFlightTime">
                      Next: {{ gate.nextFlightTime | date:'HH:mm' }}
                    </div>
                    <div class="flight-label" *ngIf="!gate.nextFlightTime">
                      Next Flight
                    </div>
                  </div>
                </div>
              </div>
  
              <div class="no-flight-info" *ngIf="!gate.currentFlight && !gate.nextFlight">
                <mat-icon>flight_land</mat-icon>
                <span>No flights assigned</span>
              </div>
            </div>
  
            <div class="card-actions">
              <button mat-icon-button color="primary" (click)="openGateAssignment(gate); $event.stopPropagation()">
                <mat-icon>edit</mat-icon>
              </button>
              <button mat-icon-button color="accent" 
                      *ngIf="canAssignFlight(gate)"
                      (click)="openGateAssignment(gate); $event.stopPropagation()">
                <mat-icon>flight_takeoff</mat-icon>
              </button>
              <button mat-icon-button color="warn" 
                      *ngIf="canReleaseGate(gate)"
                      (click)="releaseGate(gate.id); $event.stopPropagation()">
                <mat-icon>exit_to_app</mat-icon>
              </button>
            </div>
          </div>
  
          <!-- No Data Message -->
          <div *ngIf="dataSource.filteredData.length === 0 && !isLoading" class="no-data-message">
            <mat-icon>search_off</mat-icon>
            <p>No gates found matching your filters</p>
            <button mat-button (click)="clearFilters()">Clear Filters</button>
          </div>
        </div>
      </div>
  
      <!-- Visual View -->
      <div *ngIf="viewMode === 'visual'" class="visual-view">
        <div class="visual-container">
          <!-- Terminal Layout Visualization -->
          <div class="terminal-visualization">
            <div *ngFor="let terminal of terminalFilterOptions.slice(1)" class="terminal-section">
              <h3 class="terminal-title">{{ terminal.label }}</h3>
              <div class="gates-row">
                <div *ngFor="let gate of getGatesByTerminal(terminal.value)" 
                     class="visual-gate"
                     [style.background]="getStatusColor(gate.status)"
                     [class.selected]="selection.isSelected(gate)"
                     (click)="selection.toggle(gate)"
                     [matTooltip]="getGateTooltip(gate)">
                  <div class="visual-gate-number">{{ gate.gateNumber }}</div>
                  <div class="visual-gate-status">{{ gate.status.charAt(0) }}</div>
                  <div class="visual-gate-flight" *ngIf="gate.currentFlight">
                    {{ gate.currentFlight }}
                  </div>
                  <mat-checkbox class="visual-selection"
                               (click)="$event.stopPropagation()"
                               (change)="$event ? selection.toggle(gate) : null"
                               [checked]="selection.isSelected(gate)">
                  </mat-checkbox>
                </div>
              </div>
            </div>
          </div>
  
          <!-- Legend -->
          <div class="visual-legend">
            <h4>Gate Status Legend</h4>
            <div class="legend-items">
              <div *ngFor="let status of statusFilterOptions.slice(1)" class="legend-item">
                <div class="legend-color" [style.background]="status.color"></div>
                <span>{{ status.label }}</span>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  
    <!-- Footer Actions -->
    <div class="footer-actions" *ngIf="selection.hasValue()">
      <div class="footer-content">
        <span class="selected-count">{{ selection.selected.length }} gate(s) selected</span>
        <div class="footer-buttons">
          <button mat-button (click)="selection.clear()">
            <mat-icon>clear</mat-icon>
            Clear Selection
          </button>
          <button mat-raised-button color="primary" (click)="openBulkOperation()">
            <mat-icon>playlist_add_check</mat-icon>
            Perform Bulk Action
          </button>
        </div>
      </div>
    </div>
  </div>